<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Players</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Team Players</h1>

<nav>
  <a href="index.html">Leaderboard</a>
  <a href="add.html">Add Tournament</a>
</nav>

<input id="username" placeholder="Lichess username">
<button onclick="addPlayer()">Add Player</button>

<ul id="playerList"></ul>

<div id="confirmBox" class="confirm hidden">
  <p id="confirmText"></p>
  <button onclick="confirmYes()">Yes</button>
  <button onclick="confirmNo()">Cancel</button>
</div>

<script src="db.js"></script>
<script>

let deleteTarget=null;

function render(){
  const list=document.getElementById("playerList");
  list.innerHTML="";

  db.players.forEach(p=>{
    const li=document.createElement("li");

    li.innerHTML=`
      <input value="${p.username}" id="name-${p.id}">
      <button onclick="saveName('${p.id}')">Save</button>
      <button onclick="askDelete('${p.id}')">Delete</button>
    `;

    list.appendChild(li);
  });
}

function saveName(id){
  const v=document.getElementById("name-"+id).value.trim();
  db.editPlayer(id,v);
  render();
}

function askDelete(id){

  const used=db.tournaments.some(t=>
    t.players.some(p=>p.playerId===id)
  );

  if(used){
    alert("Cannot delete player â€” they exist in tournament history.\nDelete tournaments first.");
    return;
  }

  deleteTarget=id;
  document.getElementById("confirmText").textContent="Delete this player permanently?";
  document.getElementById("confirmBox").classList.remove("hidden");
}

function confirmYes(){
  db.deletePlayer(deleteTarget);
  deleteTarget=null;
  document.getElementById("confirmBox").classList.add("hidden");
  render();
}

function confirmNo(){
  deleteTarget=null;
  document.getElementById("confirmBox").classList.add("hidden");
}

function addPlayer(){
  const name=document.getElementById("username").value.trim();
  if(!name) return;
  db.addPlayer(name);
  render();
}

render();
</script>
</body>
</html>
